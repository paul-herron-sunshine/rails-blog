<% provide(:single_title, @title) %>

<% user = User.find(@comment.user_id) %>
<% likes = CommentLike.where(comment_id: @comment.id) %><!-- get all likes for comment -->
<% liked = CommentLike.where("comment_id = ? AND user_id = ?", @comment.id, current_user.id) %><!-- has user liked this post? -->

<section class="comments">
  <%= link_to 'Show all comments for ' + @post.title, post_comments_path, class: "back" %>		
  <div class="comments__container">
    <article class="comments__single">
        <header>
          <span><%= @comment.created_at.strftime("%d/%m/%Y %H:%M:%S") %></span>
          <span><%= user.admin ? "<span class='account-type'>admin</span>".html_safe : "" %> <%= @userName %></span>
        </header>    	
        <hr>
    	<main>
			<%= @comment.body %>
		</main>
		<% if current_user && current_user.id == @comment.user_id %>

			<footer class="comments__buttons-container--edit">

				<!-- Edit/delete buttons -->
				<li class="button button--comment_editsecond"><%= link_to '✍️', edit_post_comment_path(@comment.post, @comment) %></span>
	            <li class="button button--comment_editsecond"><%= link_to 'Delete', [@comment.post, @comment], method: :delete, data: { confirm: 'Are you sure?' } %></span>

	            <!-- Subfooter - likes -->
                <ul class="sub-footer">
                  <li>
                    <% if liked.count > 0 %>
                      <span class="liked" >liked <span style="font-size:1.3rem;position:absolute;margin-left:0.5rem;bottom:-0.2rem;">👍</span></span>
                    <% else %>
                      <span><%= likes.count %> likes</span>
                    <% end %>
                  </li>
                  <% if current_user && (current_user.id != @comment.user_id) && liked.all.count < 1  %>
                    <li><%= link_to 'like this', post_comment_comment_likes_path(@comment.post, @comment, user_id: current_user.id), method: :post %></li>
                  <% end %>
                </ul>

			</footer>
		<% end %>
		</div>
	</article>
  </span>
</section>


